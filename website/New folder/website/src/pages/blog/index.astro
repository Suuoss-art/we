---
// Blog listing page - ACARA (Events/News)
import BaseLayout from '../../layouts/BaseLayout.astro';

const pageTitle = "ACARA - Blog & Berita KOPMA UNNES";

// Get all blog posts using import.meta.glob (replacing deprecated Astro.glob)
const postModules = import.meta.glob('./*.astro', { eager: true });
const allPosts = Object.entries(postModules).map(([filepath, module]) => ({
  file: filepath,
  ...module
}));

const blogPosts = allPosts.filter(post =>
  post.file !== Astro.url.pathname &&
  !post.file.includes('index.astro') &&
  !post.file.includes('.bak')
).sort((a, b) => {
  // Sort by filename (most recent first, assuming newer posts have later dates)
  return b.file.localeCompare(a.file);
});
---

<BaseLayout title={pageTitle}>
  <div class="container mx-auto px-4 py-16">
    <div class="max-w-7xl mx-auto">
      <!-- Page Header -->
      <div class="text-center mb-12">
        <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">
          ACARA
        </h1>
        <p class="text-xl text-gray-600 max-w-2xl mx-auto">
          Berita, kegiatan, dan acara terkini KOPMA UNNES
        </p>
      </div>

      <!-- Blog Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {blogPosts.map((post, index) => {
          // Extract title from filename
          const filename = post.file.split('/').pop()?.replace('.astro', '') || '';
          const title = filename
            .replace(/-/g, ' ')
            .split(' ')
            .map(word => word.charAt(0).toUpperCase() + word.slice(1))
            .join(' ');
          
          const slug = filename;
          
          return (
            <article class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-xl transition-shadow duration-300">
              <div class="h-48 bg-gradient-to-br from-green-400 to-green-600 flex items-center justify-center">
                <svg class="w-16 h-16 text-white opacity-50" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"></path>
                </svg>
              </div>
              <div class="p-6">
                <div class="flex items-center gap-2 text-sm text-gray-500 mb-3">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                  </svg>
                  <time>2024</time>
                  <span>â€¢</span>
                  <span>KOPMA UNNES</span>
                </div>
                <h2 class="text-xl font-semibold text-gray-900 mb-3 line-clamp-2">
                  {title}
                </h2>
                <p class="text-gray-600 mb-4 line-clamp-3">
                  Baca selengkapnya tentang kegiatan dan berita KOPMA UNNES.
                </p>
                <a 
                  href={`/blog/${slug}`}
                  class="inline-flex items-center text-green-600 hover:text-green-700 font-medium"
                >
                  Baca Selengkapnya
                  <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
                  </svg>
                </a>
              </div>
            </article>
          );
        })}
      </div>

      <!-- Empty State -->
      {blogPosts.length === 0 && (
        <div class="text-center py-12">
          <svg class="w-16 h-16 mx-auto text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
          </svg>
          <h3 class="text-xl font-semibold text-gray-700 mb-2">Belum Ada Artikel</h3>
          <p class="text-gray-600">Artikel dan berita akan segera ditambahkan.</p>
        </div>
      )}

      <!-- Back to Home -->
      <div class="mt-12 pt-8 border-t text-center">
        <a href="/" class="inline-flex items-center text-green-600 hover:text-green-700 font-medium">
          <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
          </svg>
          Kembali ke Beranda
        </a>
      </div>
    </div>
  </div>
</BaseLayout>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
  
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
